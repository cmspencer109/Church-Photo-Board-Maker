{% extends "photomaker/base.html" %}
{% load static %}
{% block content %}

<div class="container">
  <div class="row mt-5">
    <div class="col-md-4">

      <!-- <div class="btn-group btn-group-toggle" data-toggle="buttons">
        <label class="btn btn-secondary active">
          <input type="radio" name="options" id="option1" autocomplete="off" checked> Member
        </label>
        <label class="btn btn-secondary">
          <input type="radio" name="options" id="option2" autocomplete="off"> Councilman
        </label>
      </div> -->

      <div class="mb-3">
        <label for="familyNameInput" class="form-label">Family Name</label>
        <input type="text" class="form-control" id="familyNameInput" placeholder="Luther">
      </div>
  
      <div class="mb-3">
        <label for="parentsInput" class="form-label">Parents</label>
        <input type="text" class="form-control" id="parentsInput" placeholder="Martin & Katie">
      </div>
  
      <div class="mb-3">
        <label for="childrenInput" class="form-label">Children</label>
        <textarea class="form-control" id="childrenInput" rows="6" placeholder="Hans&#10;Elizabeth&#10;Magdalene&#10;Martin&#10;Paul&#10;Margaret"></textarea>
      </div>

      <button type="submit" class="btn btn-primary" onclick="downloadMemberPhoto()">Download</button>
      
    </div>
    <div class="col-md-8">
      <div class="d-flex flex-column align-items-center">

        <div>
          <div id="photo-template">
            <div class="safe-area">
              <div class="photo-area">
  
                <!-- <img id="image" src="/static/photomaker/images/test.jpg"> -->
                <img id="image" src="">
    
              </div>
              <div class="text-area">
                <div class="family-name">Knickelbein</div>
                <div class="text-spacer">&nbsp;</div>
                <div class="parents">Mark & Sara</div>
                <div class="text-spacer">&nbsp;</div>
                <div class="children">
                  Simeon<br>
                  Henry<br>
                  Walter<br>
                  Theodore
                </div>
              </div>
            </div>
          </div>
  
          <div class="mt-3">
            <div class="custom-file">
              <input type="file" class="custom-file-input" id="imageUpload" accept="image/*">
              <!-- <label class="custom-file-label btn btn-primary" for="imageUpload">Choose Image</label> -->
            </div>
          </div>

          <div class="mt-3 btn-group" role="group">
            <button id="zoomInBtn" class="btn btn-primary"><i class="fas fa-search-plus"></i></button>
            <button id="zoomOutBtn" class="btn btn-primary"><i class="fas fa-search-minus"></i></button>
            <button id="toggleGuides" class="btn btn-primary"><i class="fas fa-ruler"></i></button>
          </div>
          
        </div>

      </div>  
    </div>
  </div>
</div>

<script type="text/javascript">
$(document).ready(function() {
  // Family Name field live update
  $('#familyNameInput').on('input', function() {
    var familyName = $(this).val();
    $('.family-name').text(familyName);
  });

  // Parents field live update
  $('#parentsInput').on('input', function() {
    var parents = $(this).val();
    $('.parents').text(parents);
  });

  // Children field live update
  $('#childrenInput').on('input', function() {
    var children = $(this).val().split('\n').join('<br>');
    $('.children').html(children);
  });

  $('.custom-file-input').on('change', function() {
    var file = this.files[0];
    var reader = new FileReader();
    

    reader.onload = function(event) {
      console.log(event.target.result)
      // $('#image').attr('src', event.target.result);
      cropper.replace(event.target.result);
    };

    reader.readAsDataURL(file);
  });

  $('#toggleGuides').click(function() {
    $('#photo-template').toggleClass('guides');
  });
});

function downloadMemberPhoto() {
  htmlToImage.toJpeg(document.getElementById('photo-template'), { quality: 1 })
  .then(function (dataUrl) {
    var link = document.createElement('a');
    link.download = 'member-photo.jpg';
    link.href = dataUrl;
    link.click();
  });
}

const image = document.getElementById('image');
const cropper = new Cropper(image, {
  viewMode: 3,
  dragMode: 'move',
  // aspectRatio: 16 / 9,
  guide: false,
  background: false,
  autoCrop: false,
  autoCropArea: 1,
  cropBoxMovable: false,
  cropBoxResizable: false,

  guides: false,
  center: false,
  highlight: false,
});

const zoomInBtn = document.getElementById('zoomInBtn');
const zoomOutBtn = document.getElementById('zoomOutBtn');

zoomInBtn.addEventListener('click', function() {
  cropper.zoom(0.1);
});

zoomOutBtn.addEventListener('click', function() {
  cropper.zoom(-0.1);
});

</script>

{% endblock content %}
